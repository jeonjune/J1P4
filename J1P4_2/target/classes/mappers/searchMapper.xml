<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itwillbs.mapper.SearchMapper">


	<!-- 검색 결과 리스트 목록 ( 페이징 처리 ) -->
	<select id="searchMem" resultType="MemberVO">
	
		SELECT * FROM member
		<if test="searchType == 'searchAll'">
			WHERE (mem_name LIKE CONCAT('%', #{keyword}, '%')
			OR mem_phone LIKE CONCAT('%', #{keyword}, '%')
			OR mem_email LIKE CONCAT('%', #{keyword}, '%')) AND mem_delete is null
		</if>
		<if test="searchType == 'searchName'">
			WHERE (mem_name LIKE CONCAT('%', #{keyword}, '%')) AND mem_delete is null
		</if>
		<if test="searchType == 'searchPhoneNum'">
			WHERE (mem_phone LIKE CONCAT('%', #{keyword}, '%')) AND mem_delete is null
		</if>
		<if test="searchType == 'searchEmail'">
			WHERE (mem_email LIKE CONCAT('%', #{keyword}, '%')) AND mem_delete is null
		</if>
		<if test="memYear != null">
			AND reg_date LIKE CONCAT(#{memYear}, '%')
		</if>
		<if test="filter != null and filter != ''">
			AND mem_rank = #{filter}
		</if>
		<if test="mem_gender != null and mem_gender != ''">
			AND mem_gender = #{mem_gender}
		</if>
		ORDER BY
		<choose>
			<when
				test="sortVal != null and sortVal != ''">
				<if test="sortVal == 'mem_name'">
					mem_name
				</if>
				<if test="sortVal == 'reg_date'">
					reg_date
				</if>
			</when>
			<otherwise>
				mem_no
			</otherwise>
		</choose>
		<choose>	
			<when
				test ="sortCri != null and sortCri != ''">	
				<if test="sortCri == 'asc'">
					ASC
				</if>
				<if test="sortCri == 'desc'">
					DESC
				</if>
			</when>
			<otherwise>
				DESC
			</otherwise>
		</choose>
		LIMIT #{pageStart}, #{pageSize}
	</select>

	<!-- 검색 결과 리스트 개수 ( 페이징 처리 ) -->
	<select id="totalCount" resultType="int">
    SELECT count(mem_no) FROM member
    <where>
        <choose>
            <when test="searchType == 'searchAll'">
                (mem_name LIKE CONCAT('%', #{keyword}, '%')
                OR mem_phone LIKE CONCAT('%', #{keyword}, '%')
                OR mem_email LIKE CONCAT('%', #{keyword}, '%')) AND mem_delete is null
            </when>
            <when test="searchType == 'searchName'">
                mem_name LIKE CONCAT('%', #{keyword}, '%') AND mem_delete is null
            </when>
            <when test="searchType == 'searchPhoneNum'">
                mem_phone LIKE CONCAT('%', #{keyword}, '%') AND mem_delete is null
            </when>
            <when test="searchType == 'searchEmail'">
                mem_email LIKE CONCAT('%', #{keyword}, '%') AND mem_delete is null
            </when>
            <otherwise>
                1=1 AND mem_delete is null
            </otherwise>
        </choose>
        <if test="memYear != null">
            AND reg_date LIKE CONCAT(#{memYear}, '%')
        </if>
        <if test="filter != null and filter != ''">
            AND mem_rank = #{filter}
        </if>
        <if test="mem_gender != null and mem_gender != ''">
            AND mem_gender = #{mem_gender}
        </if>
    </where>
</select>



</mapper>