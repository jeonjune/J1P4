<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itwillbs.mapper.SearchMapper">


	<!-- 검색 결과 리스트 목록 ( 페이징 처리 ) -->
	<select id="searchMem" resultType="MemberVO">
		SELECT * FROM member
    	WHERE (mem_name LIKE CONCAT('%', #{keyword}, '%')
        OR mem_phone LIKE CONCAT('%', #{keyword}, '%')
        OR mem_email LIKE CONCAT('%', #{keyword}, '%'))
    <if test="memYear != null">
        AND reg_date LIKE CONCAT(#{memYear}, '%')
    </if>
    <if test="filter != null and filter != ''">
        AND mem_rank = #{filter}
    </if>
    <if test="mem_gender != null and mem_gender != ''">
        AND mem_gender = #{mem_gender}
    </if>
    <choose>
        <when test="sortVal == 'mem_name'">
            <if test="sortCri != null and sortCri != ''">
                ORDER BY mem_name ${sortCri}
            </if>
        </when>
        <when test="sortVal == 'mem_phone'">
            <if test="sortCri != null and sortCri != ''">
                ORDER BY mem_phone ${sortCri}
            </if>
        </when>
        <when test="sortVal == 'mem_email'">
            <if test="sortCri != null and sortCri != ''">
                ORDER BY mem_email ${sortCri}
            </if>
        </when>
        <otherwise>
            <if test="sortCri != null and sortCri != ''">
                ORDER BY mem_no DESC
            </if>
        </otherwise>
    </choose>
    LIMIT #{pageStart}, #{pageSize}
	</select>

	<!-- 검색 결과 리스트 개수 ( 페이징 처리 ) -->
	<select id="totalCount" resultType="int">
		SELECT count(mem_no) FROM member
    	WHERE (mem_name LIKE CONCAT('%', #{keyword}, '%')
        OR mem_phone LIKE CONCAT('%', #{keyword}, '%')
        OR mem_email LIKE CONCAT('%', #{keyword}, '%'))
    <if test="memYear != null">
        AND reg_date LIKE CONCAT(#{memYear}, '%')
    </if>
    <if test="filter != null and filter != ''">
        AND mem_rank = #{filter}
    </if>
    <if test="mem_gender != null and mem_gender != ''">
        AND mem_gender = #{mem_gender}
    </if>
	</select>
	
	

</mapper>